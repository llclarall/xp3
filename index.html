<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>XP3 - Frise P√©dagogique</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Palette */
            --primary: #FFD700;
            --text-dark: #2c3e50;
            --glass: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.5);
            
            /* Dimensions Structurelles */
            --control-height: 140px; /* Espace r√©serv√© en bas pour les mains */
            
            /* Couleurs √âpoques */
            --c-pre: #2c3e50; 
            --c-ant: #e67e22; 
            --c-moy: #27ae60; 
            --c-ren: #8e44ad; 
            --c-ind: #7f8c8d;
            --c-mod: #2980b9;
        }

        body {
            margin: 0; padding: 0; overflow: hidden; height: 100vh; width: 100vw;
            font-family: 'Fredoka', sans-serif; background: #222;
            user-select: none; touch-action: none; display: flex; flex-direction: column;
        }

        /* --- 1. LE MONDE (ARRI√àRE-PLAN) --- */
        #game-viewport { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            z-index: 0; overflow: hidden; 
        }
        #world-track { 
            display: flex; height: 100%; width: 600%; /* Total flex = 6 (toutes √©gales) */
            will-change: transform; transition: transform 0.1s linear; 
        }
        .era-slide { height: 100%; position: relative; overflow: hidden; }
        .slide-1 { flex: 1; } /* Pr√©histoire: -30 000 √† -3 000 */
        .slide-2 { flex: 1; } /* Antiquit√©: 3,500 ans */
        .slide-3 { flex: 1; } /* Moyen-√Çge: 1,000 ans */
        .slide-4 { flex: 1; } /* Renaissance: 300 ans */
        .slide-5 { flex: 1; } /* R√©volution Industrielle: 150 ans */
        .slide-6 { flex: 1; } /* Moderne: 80 ans */

        /* --- D√âCORS (GARD√âS DE LA VERSION PR√âC√âDENTE) --- */
        .slide-1 { background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364); }
        .slide-2 { background: linear-gradient(to bottom, #FF8008, #FFC837); }
        .slide-3 { background: linear-gradient(to bottom, #2980B9, #6DD5FA); }
        .slide-4 { background: linear-gradient(to bottom, #654ea3, #eaafc8); }
        .slide-5 { background: linear-gradient(to bottom, #434343, #000000); }
        .slide-6 { background: linear-gradient(to bottom, #141E30, #243B55); }

        /* √âl√©ments CSS Art */
        .mountain { position: absolute; bottom: var(--control-height); left: 0; width: 100%; height: 50%; background: #141E30; clip-path: polygon(0% 100%, 15% 30%, 30% 80%, 45% 40%, 60% 90%, 75% 20%, 90% 60%, 100% 100%); opacity: 0.8; }
        .cave { position: absolute; bottom: var(--control-height); left: 10%; width: 250px; height: 180px; background: #080808; border-radius: 50% 50% 0 0; box-shadow: inset 0 20px 40px rgba(0,0,0,0.8); border: 2px solid rgba(255,255,255,0.1); }
        .dunes { position: absolute; bottom: var(--control-height); left: 0; width: 120%; height: 40%; background: #e67e22; border-radius: 100% 100% 0 0; transform: translateX(-10%); }
        .hills { position: absolute; bottom: var(--control-height); left: -10%; width: 120%; height: 45%; background: #27ae60; border-radius: 50% 50% 0 0; }
        .city { position: absolute; bottom: var(--control-height); left: 0; width: 100%; height: 35%; background: linear-gradient(#34495e, #34495e) 5% 100% / 8% 60% no-repeat, linear-gradient(#2c3e50, #2c3e50) 20% 100% / 10% 80% no-repeat, linear-gradient(#34495e, #34495e) 40% 100% / 12% 50% no-repeat, linear-gradient(#2c3e50, #2c3e50) 80% 100% / 10% 70% no-repeat; opacity: 0.8; }
        
        .bg-stars { position: absolute; top:0; left:0; width:100%; height:80%; background-image: radial-gradient(white 2px, transparent 2px); background-size: 60px 60px; opacity: 0.6; }
        .sun { position: absolute; top: 15%; right: 20%; width: 15vh; height: 15vh; background: #FFF; border-radius: 50%; box-shadow: 0 0 60px #FFD54F; }

        /* --- OBJETS & HOTSPOTS --- */
        .prop-group { 
            position: absolute; 
            bottom: calc(var(--control-height) + 80px); /* Bien au dessus du sol */
            z-index: 10; 
        }
        .prop-emoji { font-size: 16vh; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3)); }
        
        .hotspot-btn {
            position: absolute; top: 0; right: -10px;
            width: 44px; height: 44px; background: white;
            border-radius: 50%; border: 4px solid var(--primary);
            color: var(--text-dark); font-weight: bold; font-size: 24px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: pulseBtn 2s infinite;
        }
        .info-bubble {
            position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%) scale(0);
            width: 240px; background: white; padding: 15px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4); text-align: center;
            font-size: 18px; color: #333; pointer-events: none; opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 100;
        }
        .info-bubble.active { transform: translateX(-50%) scale(1); opacity: 1; pointer-events: auto; }
        .info-bubble::after { content:''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); border-width: 10px 10px 0; border-style: solid; border-color: white transparent transparent; }

        /* --- SOL & FRISE (HI√âRARCHIS√âS) --- */
        .ground { 
            position: absolute; 
            bottom: calc(var(--control-height) + 20px); /* Le sol commence AU-DESSUS des contr√¥les */
            width: 100%; height: 60px; 
            border-bottom: 4px solid rgba(255,255,255,0.4); 
            z-index: 20;
        }
        .timeline-markers { position: absolute; bottom: -20px; left: 0; width: 100%; height: 100%; }
        
        .marker-main { 
            position: absolute; bottom: 30px; left: 20px;
            background: #2D3436; color: white; padding: 8px 20px; 
            border-radius: 12px; font-size: 2.2vh; font-weight: 900; 
            border: 2px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .marker-sub { 
            position: absolute; bottom: 0; height: 40px; 
            border-left: 3px solid rgba(255,255,255,0.6); 
            display: flex; flex-direction: column; align-items: center; 
        }
        .marker-sub span { 
            margin-top: -35px; background: rgba(255,255,255,0.9); color: #333; 
            padding: 3px 8px; border-radius: 5px; font-weight: bold; font-size: 1.5vh; 
            white-space: nowrap; 
        }

        .era-watermark { 
            position: absolute; top: 10px; right: 50%; transform: translateX(50%); 
            font-size: 6vw; font-weight: 900; color: rgba(255, 255, 255, 0.54); 
            text-transform: uppercase; letter-spacing: 10px; pointer-events: none; 
            width: 90%; text-align: center;  
        }

        /* --- UI HAUTE (MISSION) --- */
        .top-hud {
            position: absolute; top: 30px; left: 30px;
            z-index: 100;
        }
        .mission-bubble {
            background: var(--glass); backdrop-filter: blur(10px);
            border: 3px solid white; border-radius: 20px;
            padding: 15px 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .m-title { font-size: 14px; text-transform: uppercase; color: #666; font-weight: bold; margin-bottom: 5px; }
        .m-content { font-size: 24px; color: var(--text-dark); font-weight: 800; }

        /* --- ERA INDICATOR --- */
        .era-indicator { 
            position: fixed; top: 30px; right: 30px; font-size: 6vw; z-index: 95; font-weight: 900; color: rgba(255, 255, 255, 0.54);text-transform: uppercase; letter-spacing: 10px; pointer-events: none; 
        }

        /* --- UI BASSE (CONTROLS - ZONE MAINS) --- */
        .top-nav {
            position: absolute; top: 300px; left: 0; width: 100%;
            padding: 0 30px; box-sizing: border-box; z-index: 110;
        }

        .bottom-hud {
            position: absolute; bottom: 20px; left: 0; width: 100%;
            height: 100px;
            display: flex; justify-content: flex-end;
            padding: 0 30px; box-sizing: border-box;
            align-items: center; z-index: 100;
        }

        .nav-bar {
            height: 80px; background: white; border-radius: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            padding: 8px; display: flex; align-items: center;
            border: 4px solid rgba(255,255,255,0.5);
        }
        .nav-track { flex: 1; height: 100%; border-radius: 32px; position: relative; overflow: hidden; display: flex; }
        
        .nav-seg { height: 100%; opacity: 0.8; transition: 0.2s; cursor: pointer; border-right: 1px solid rgba(255,255,255,0.3); display: flex; justify-content: center; align-items: center; color: rgba(255,255,255,0.7); font-weight: bold; font-size: 12px; text-transform: uppercase; text-align: center; padding: 0px 15px; }
        .nav-seg:hover { opacity: 1; color: white; }
        
        .seg-1 { background: var(--c-pre); flex: 1; } /* Pr√©histoire: -30 000 √† -3 000 */
        .seg-2 { background: var(--c-ant); flex: 1; } /* Antiquit√©: 3,500 ans */
        .seg-3 { background: var(--c-moy); flex: 1; } /* Moyen-√Çge: 1,000 ans */
        .seg-4 { background: var(--c-ren); flex: 1; } /* Renaissance: 300 ans */
        .seg-5 { background: var(--c-ind); flex: 1; } /* R√©volution Industrielle: 150 ans */
        .seg-6 { background: var(--c-mod); flex: 1; } /* Moderne: 80 ans */

        /* --- FRISE STATIQUE √Ä L'√âCHELLE --- */
        .static-scale { position: absolute; left: 30px; right: 30px; top: 150px; z-index: 120; pointer-events: none; }
        .scale-card { background: rgba(0,0,0,0.6); border: 2px solid rgba(255,255,255,0.25); border-radius: 18px; padding: 10px 14px; box-shadow: 0 15px 35px rgba(0,0,0,0.35); }
        .scale-title { color: white; font-weight: 900; font-size: 14px; letter-spacing: 1px; margin-bottom: 8px; text-transform: uppercase; opacity: 0.85; }
        .scale-bar { position: relative; display: flex; height: 44px; border-radius: 12px; overflow: hidden; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.08); }
        .scale-seg { position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; gap: 2px; padding: 0 6px; min-width: 16px; }
        .scale-seg span { font-weight: 800; font-size: 12px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); white-space: nowrap; }
        .scale-seg small { font-size: 10px; opacity: 0.85; white-space: nowrap; }
        .scale-pre { background: var(--c-pre); }
        .scale-ant { background: var(--c-ant); }
        .scale-moy { background: var(--c-moy); }
        .scale-ren { background: var(--c-ren); }
        .scale-ind { background: var(--c-ind); }
        .scale-mod { background: var(--c-mod); }
        .scale-pointer { position: absolute; top: -8px; width: 3px; height: 60px; background: white; box-shadow: 0 0 0 3px rgba(255,255,255,0.2); border-radius: 2px; pointer-events: none; transition: left 0.1s linear; }
        .scale-pointer-label { position: absolute; top: -22px; left: 50%; transform: translateX(-50%); background: white; color: #2c3e50; padding: 2px 6px; border-radius: 8px; font-weight: 800; font-size: 11px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); white-space: nowrap; }
        .scale-cursor { position: absolute; top: 50%; left: 0%; transform: translateX(-50%) translateY(-50%); font-size: 26px; pointer-events: none; transition: left 0.1s linear; filter: drop-shadow(0 3px 6px rgba(0,0,0,0.4)); z-index: 10; }
        .scale-legend { display: flex; justify-content: space-between; color: rgba(255,255,255,0.85); font-size: 11px; margin-top: 6px; }
        .scale-note { color: rgba(255,255,255,0.65); font-size: 11px; margin-top: 4px; }

        /* CURSEUR ADAPTATIF */
.nav-knob {
    position: absolute; left: 0; top: 0; height: 100%;
    /* La largeur sera pilot√©e par le JS, on met une valeur par d√©faut */
    width: 16.66%; 
    border: 5px solid white; border-radius: 32px; box-sizing: border-box;
    box-shadow: 0 0 0 2000px rgba(0,0,0,0.5); /* Focus visuel qui assombrit le reste */
    cursor: ew-resize; display: flex; justify-content: center; align-items: center;
    /* Animation fluide quand la largeur change */
    transition: width 0.3s cubic-bezier(0.25, 1, 0.5, 1); 
}
        .grip-lines { color: white; font-weight: 900; font-size: 24px; letter-spacing: -2px; }

        /* Le Dock du Personnage */
        .char-dock {
            width: 100px; height: 100px;
            background: rgba(255,255,255,0.3); backdrop-filter: blur(5px);
            border-radius: 50%; border: 3px dashed rgba(255,255,255,0.6);
            display: flex; justify-content: center; align-items: center;
        }
        .liko-token {
            width: 90px; height: 90px; background: var(--primary);
            border: 5px solid white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 55px; cursor: grab;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            animation: bounce 3s infinite;
        }
        .liko-token:active { animation: none; transform: scale(0.9); cursor: grabbing; }

        .liko-img { width: 100%; height: 100%; object-fit: contain; max-width: 250px; }

        /* --- FEEDBACK --- */
        #ghost { position: fixed; font-size: 90px; opacity: 0; pointer-events: none; z-index: 9999; }
        
        .arrow-hint { position: absolute; top: 50%; transform: translateY(-50%); width: 100px; height: 100px; background: #FF4757; color: white; border-radius: 50%; font-size: 50px; display: none; justify-content: center; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.4); border: 5px solid white; animation: pulseBtn 1s infinite; z-index: 500; }
        #arrow-left { left: 50px; } #arrow-right { right: 50px; }

        #liko-landed { position: absolute; bottom: 200px; left: 15%; font-size: 18vh; display: none; filter: drop-shadow(0 10px 5px rgba(0,0,0,0.4)); animation: bounceDrop 0.8s ease-out; z-index: 5; }

        /* --- POLAROID --- */
        .polaroid-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(10px); opacity: 0; transition: opacity 0.5s;
        }
        .polaroid {
            background: white; padding: 20px 20px 80px 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5); transform: rotate(-3deg) scale(0.8);
            text-align: center; transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }
        .polaroid-img {
            width: 450px; height: 350px; background: #333; overflow: hidden; position: relative;
            display: flex; justify-content: center; align-items: center;
        }
        .polaroid-caption {
            position: absolute; bottom: 25px; width: 100%; left: 0;
            font-family: 'Courier New', monospace; font-weight: bold; font-size: 28px; color: #333;
        }
        .tape { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); width: 180px; height: 50px; background: rgba(255,255,255,0.6); box-shadow: 0 2px 5px rgba(0,0,0,0.1); transform: rotate(2deg); }

        /* ANIMATIONS */
        @keyframes pulseBtn { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes bounceDrop { 0% { transform: translateY(-50px); opacity:0; } 60% { transform: translateY(10px); opacity:1; } 100% { transform: translateY(0); } }
        @keyframes flicker { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.1); opacity: 0.8; } }

    </style>
</head>
<body>

    <div id="game-viewport">
        <div id="world-track">
            
            <div class="era-slide slide-1">
                <!-- <div class="era-watermark">PR√âHISTOIRE</div> -->
                <div class="bg-stars"></div>
                <div class="mountain"></div>
                <div class="cave"></div>
                
                <div class="prop-group fire-anim" style="left: 45%;">
                    <div class="prop-emoji">üî•</div>
                    <div class="hotspot-btn" onclick="toggleInfo(this)">?</div>
                    <div class="info-bubble">Le feu prot√©geait les hommes des b√™tes sauvages.</div>
                </div>

                <div class="ground">
                    <div class="timeline-markers">
                        <div class="marker-main" style="left: 20px;">-30 000</div>
                        <div class="marker-sub" style="left: 50%;"><span>-15 000</span></div>
                        <div class="marker-sub" style="left: 90%;"><span>-3 000</span></div>
                    </div>
                </div>
            </div>

            <div class="era-slide slide-2">
                <!-- <div class="era-watermark">ANTIQUIT√â</div> -->
                <div class="dunes"></div>
                <div class="prop-group" style="left: 25%;">
                    <div class="prop-emoji">üê™</div>
                </div>
                <div class="prop-group" style="left: 65%;">
                    <div class="prop-emoji">üèõÔ∏è</div>
                    <div class="hotspot-btn" onclick="toggleInfo(this)">?</div>
                    <div class="info-bubble">Le Colis√©e de Rome pouvait accueillir 50 000 personnes !</div>
                </div>
                <div class="ground">
                    <div class="timeline-markers">
                        <div class="marker-main" style="left: 20px;">-3 000</div>
                        <div class="marker-sub" style="left: 40%;"><span>-753</span></div>
                        <div class="marker-sub" style="left: 80%;"><span>-52</span></div>
                    </div>
                </div>
            </div>

            <div class="era-slide slide-3">
                <!-- <div class="era-watermark">MOYEN-√ÇGE</div> -->
                <div class="hills"></div>
                <div class="prop-group" style="left: 40%;">
                    <div class="prop-emoji">üè∞</div>
                    <div class="hotspot-btn" onclick="toggleInfo(this)">?</div>
                    <div class="info-bubble">Les ponts-levis servaient √† fermer l'entr√©e du ch√¢teau.</div>
                </div>
                <div class="prop-group" style="left: 80%;">
                    <div class="prop-emoji">üõ°Ô∏è</div>
                </div>
                <div class="ground">
                    <div class="timeline-markers">
                        <div class="marker-main" style="left: 20px;">476</div>
                        <div class="marker-sub" style="left: 50%;"><span>800</span></div>
                        <div class="marker-sub" style="left: 90%;"><span>1492</span></div>
                    </div>
                </div>
            </div>

            <div class="era-slide slide-4">
                <!-- a -->
                <div class="city"></div>
                <div class="prop-group" style="left: 35%;">
                    <div class="prop-emoji">üé®</div>
                    <div class="hotspot-btn" onclick="toggleInfo(this)">?</div>
                    <div class="info-bubble">La Renaissance a red√©couvert l'art antique.</div>
                </div>
                <div class="prop-group" style="left: 75%;">
                    <div class="prop-emoji">üî≠</div>
                </div>
                <div class="ground">
                    <div class="timeline-markers">
                        <div class="marker-main" style="left: 20px;">1492</div>
                        <div class="marker-sub" style="left: 50%;"><span>1500</span></div>
                        <div class="marker-sub" style="left: 90%;"><span>1789</span></div>
                    </div>
                </div>
            </div>

            <div class="era-slide slide-5">
                <!-- <div class="era-watermark">R√âVOLUTION INDUSTRIELLE</div> -->
                <div class="city"></div>
                <div class="prop-group" style="left: 30%;">
                    <div class="prop-emoji">üè≠</div>
                    <div class="hotspot-btn" onclick="toggleInfo(this)">?</div>
                    <div class="info-bubble">La machine √† vapeur a r√©volutionn√© la production.</div>
                </div>
                <div class="prop-group" style="left: 70%;">
                    <div class="prop-emoji">üöÇ</div>
                </div>
                <div class="ground">
                    <div class="timeline-markers">
                        <div class="marker-main" style="left: 20px;">1789</div>
                        <div class="marker-sub" style="left: 60%;"><span>1850</span></div>
                        <div class="marker-sub" style="left: 90%;"><span>1945</span></div>
                    </div>
                </div>
            </div>

            <div class="era-slide slide-6">
                <!-- <div class="era-watermark">MODERNE</div> -->
                <div class="city"></div>
                <div class="prop-group" style="left: 25%;">
                    <div class="prop-emoji">üíª</div>
                    <div class="hotspot-btn" onclick="toggleInfo(this)">?</div>
                    <div class="info-bubble">L'informatique a transform√© notre monde.</div>
                </div>
                <div class="prop-group" style="left: 80%;">
                    <div class="prop-emoji">üöÄ</div>
                </div>
                <div class="ground">
                    <div class="timeline-markers">
                        <div class="marker-main" style="left: 20px;">1945</div>
                        <div class="marker-sub" style="left: 50%;"><span>1990</span></div>
                        <div class="marker-sub" style="left: 85%;"><span>2024</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="liko-landed"><img src="images/Liko.png" alt="liko" class="liko-img"></div>
    </div>

    <div class="era-indicator" id="era-name">PR√âHISTOIRE</div>

    <div class="top-hud">
        <div class="mission-bubble">
            <span class="m-title">Mission</span>
            <span class="m-content">Place l'Homme de Cro-Magnon üßî <br>dans son √©poque</span>
        </div>
    </div>

    <div class="top-nav">
        <div class="nav-bar" id="nav-container">
            <div class="nav-track">
                <div class="nav-seg seg-1" onclick="jump(0)">Pr√©histoire</div>
                <div class="nav-seg seg-2" onclick="jump(16.67)">Antiquit√©</div>
                <div class="nav-seg seg-3" onclick="jump(33.33)">Moyen-√Çge</div>
                <div class="nav-seg seg-4" onclick="jump(50)">Renaissance</div>
                <div class="nav-seg seg-5" onclick="jump(66.67)">R√©volution Industrielle</div>
                <div class="nav-seg seg-6" onclick="jump(83.33)">Moderne</div>
                <div class="nav-knob" id="knob"><span class="grip-lines">|||</span></div>
            </div>
        </div>
    </div>

    <div class="static-scale">
        <div class="scale-card">
            <div class="scale-title">Frise chronologique statique (√† l'√©chelle)</div>
            <div class="scale-bar">
                <div class="scale-pointer" id="scale-pointer"><div class="scale-pointer-label" id="scale-year-label">-30 000</div></div>
                <div class="scale-cursor" id="scale-cursor">üìç</div>
                <div class="scale-seg scale-pre" style="flex: 27;"><!-- <span>Pr√©histoire</span><small>27 000 ans</small> --></div>
                <div class="scale-seg scale-ant" style="flex: 3.5;"><!-- <span>Antiquit√©</span><small>3 500 ans</small> --></div>
                <div class="scale-seg scale-moy" style="flex: 1;"><!-- <span>Moyen-√Çge</span><small>1 000 ans</small> --></div>
                <div class="scale-seg scale-ren" style="flex: 0.3;"><!-- <span>Renaissance</span><small>300 ans</small> --></div>
                <div class="scale-seg scale-ind" style="flex: 0.15;"><!-- <span>R√©volution Ind.</span><small>150 ans</small> --></div>
                <div class="scale-seg scale-mod" style="flex: 0.08;"><!-- <span>Moderne</span><small>80 ans</small> --></div>
            </div>
            <div class="scale-legend">
                <span>-30 000</span>
                <span>-3 000</span>
                <span>476</span>
                <span>1492</span>
                <span>1789</span>
                <span>1945</span>
                <span>2024</span>
            </div>
        </div>
    </div>

    <div class="bottom-hud">
        <div class="char-dock">
            <div class="liko-token" id="liko"><img src="images/Liko.png" alt="liko" class="liko-img"></div>
        </div>
    </div>

    <div class="era-labels">
        <div class="era-label label-1">Pr√©histoire</div>
        <div class="era-label label-2">Antiquit√©</div>
        <div class="era-label label-3">Moyen-√Çge</div>
        <div class="era-label label-4">Renaissance</div>
        <div class="era-label label-5">R√©volution Industrielle</div>
        <div class="era-label label-6">Moderne</div>
    </div>

    <div id="arrow-left" class="arrow-hint">‚¨ÖÔ∏è</div>
    <div id="arrow-right" class="arrow-hint">‚û°Ô∏è</div>
    <div id="ghost"><img src="images/Liko.png" alt="liko" class="liko-img"></div>

    <div class="polaroid-overlay" id="victory">
        <div class="polaroid">
            <div class="tape"></div>
            <div class="polaroid-img">
                <div style="font-size: 150px; position:absolute; left:-20px;">‚õ∞Ô∏è</div>
                <div style="font-size: 150px; position:absolute; right:0; transform:rotate(10deg);">‚úåÔ∏è<img src="images/Liko.png" alt="liko" class="liko-img" style="width: 100px; height: 100px; vertical-align: middle;"></div>
            </div>
            <div class="polaroid-caption">Souvenir de -30 000 !</div>
            <button onclick="location.reload()" style="margin-top: 30px; font-size: 24px; padding: 15px 40px; border-radius: 50px; border: 3px solid #333; background: #FFD700; cursor: pointer; font-weight: 900; box-shadow: 5px 5px 0 #333;">REJOUER</button>
        </div>
    </div>

    <script>
        const world = document.getElementById('world-track');
        const knob = document.getElementById('knob');
        const navContainer = document.getElementById('nav-container');
        const liko = document.getElementById('liko');
        const ghost = document.getElementById('ghost');
        const arrowL = document.getElementById('arrow-left');
        const arrowR = document.getElementById('arrow-right');
        const victoryScreen = document.getElementById('victory');
        const navSegments = Array.from(document.querySelectorAll('.nav-seg'));
        const eraIndicator = document.getElementById('era-name');
        const scalePointer = document.getElementById('scale-pointer');
        const scaleCursor = document.getElementById('scale-cursor');
        const scaleYearLabel = document.getElementById('scale-year-label');
        
        // Calcul temporel
        const timelineStart = -30000;
        const timelineEnd = 2024;
        const timelineRange = timelineEnd - timelineStart;

        // Flex de base de chaque √©poque (toutes √©gales)
        const eraFlex = [1, 1, 1, 1, 1, 1];
        
        // Flex de la frise statique (proportions r√©alistes de -30 000 √† 2024)
        const staticFlex = [27, 3.5, 1, 0.3, 0.15, 0.08]; // 27k, 3.5k, 1k, 300, 150, 80 ans
        const staticTotal = staticFlex.reduce((a, b) => a + b, 0);
        
        // Calcul des seuils de la frise statique en %
        const staticThresholds = [0];
        let cumul = 0;
        for (let i = 0; i < staticFlex.length; i++) {
            cumul += (staticFlex[i] / staticTotal) * 100;
            staticThresholds.push(cumul);
        }
        
        // Fonction de mapping entre frise interactive et frise statique
        function mapToStaticScale(scrollPct) {
            // Bornes de la frise interactive: √©poques √©gales (16.67% chacune)
            const interactiveBounds = [0, 16.67, 33.33, 50, 66.67, 83.33, 100];
            
            // Trouve l'√©poque courante
            let eraIdx = 0;
            for (let i = 0; i < interactiveBounds.length - 1; i++) {
                if (scrollPct >= interactiveBounds[i] && scrollPct < interactiveBounds[i + 1]) {
                    eraIdx = i;
                    break;
                }
            }
            if (scrollPct >= 83.33) eraIdx = 5;
            
            // Position relative dans l'√©poque (0 √† 1)
            const eraStart = interactiveBounds[eraIdx];
            const eraEnd = interactiveBounds[eraIdx + 1];
            const relativePos = (scrollPct - eraStart) / (eraEnd - eraStart);
            
            // Mappe vers la frise statique
            const staticStart = staticThresholds[eraIdx];
            const staticEnd = staticThresholds[eraIdx + 1];
            return staticStart + relativePos * (staticEnd - staticStart);
        }

        let scrollPct = 0;
        let isNav = false;
        let isDrag = false;

        // --- MOTEUR ---
        function update() {
            scrollPct = Math.max(0, Math.min(100, scrollPct));

            // D√©tecte l'√©poque courante pour √©largir temporairement la zone
            // Bornes: √©poques √©gales (16.67% chacune)
            const eraNames = ['PR√âHISTOIRE', 'ANTIQUIT√â', 'MOYEN-√ÇGE', 'RENAISSANCE', 'R√âVOLUTION INDUSTRIELLE', 'MODERNE'];
            let eraIdx = 0;
            if (scrollPct >= 16.67 && scrollPct < 33.33) eraIdx = 1;
            else if (scrollPct >= 33.33 && scrollPct < 50) eraIdx = 2;
            else if (scrollPct >= 50 && scrollPct < 66.67) eraIdx = 3;
            else if (scrollPct >= 66.67 && scrollPct < 83.33) eraIdx = 4;
            else if (scrollPct >= 83.33) eraIdx = 5;
            
            eraIndicator.textContent = eraNames[eraIdx];
            // Le Knob bouge de 0 √† 83.3% (6 segments de 16.6% chacun)
            knob.style.left = (scrollPct * 0.833) + '%';
            // Le monde bouge de 0 √† -500vw (600% - 100%)
            world.style.transform = `translateX(${-(scrollPct / 100) * 500}vw)`;
            
            // Met √† jour le pointeur et le curseur de la frise statique (mapping proportionnel)
            const staticPct = mapToStaticScale(scrollPct);
            if (scalePointer) {
                scalePointer.style.left = staticPct + '%';
            }
            if (scaleCursor) {
                scaleCursor.style.left = staticPct + '%';
            }
            if (scaleYearLabel) {
                const currentYear = Math.round(timelineStart + (scrollPct / 100) * timelineRange);
                scaleYearLabel.textContent = currentYear.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            }
        }

        window.jump = (val) => { scrollPct = val; update(); }

        window.toggleInfo = (btn) => {
            const bubble = btn.nextElementSibling;
            document.querySelectorAll('.info-bubble').forEach(b => { if(b!==bubble) b.classList.remove('active'); });
            bubble.classList.toggle('active');
        }

        // --- NAV ---
        function navMove(e) {
            if(!isNav) return;
            e.preventDefault();
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const rect = navContainer.getBoundingClientRect();
            
            // Calcul dynamique bas√© sur la largeur totale actuelle (avec flex)
            const totalWidth = rect.width;
            let pct = ((cx - rect.left) / totalWidth) * 100;
            scrollPct = Math.max(0, Math.min(100, pct));
            update();
        }

        knob.addEventListener('mousedown', () => isNav=true);
        knob.addEventListener('touchstart', () => isNav=true);
        window.addEventListener('mouseup', () => isNav=false);
        window.addEventListener('touchend', () => isNav=false);
        window.addEventListener('mousemove', navMove);
        window.addEventListener('touchmove', navMove, {passive:false});

        // --- DRAG ---
        function dragMove(e) {
            if(!isDrag) return;
            e.preventDefault();
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            ghost.style.left = (cx - 50) + 'px';
            ghost.style.top = (cy - 50) + 'px';
        }

        function dragStart(e) {
            isDrag = true;
            ghost.style.opacity = 1;
            liko.style.opacity = 0;
            dragMove(e);
            arrowL.style.display = 'none';
            arrowR.style.display = 'none';
        }

        function dragEnd() {
            if(!isDrag) return;
            isDrag = false;
            ghost.style.opacity = 0;

            // VICTOIRE : Zone Pr√©histoire (< 16.67%)
            if(scrollPct < 16.67) {
                document.querySelector('.top-hud').style.display = 'none'; // Cache Mission
                document.getElementById('liko-landed').style.display = 'block';
                document.getElementById('liko-landed').style.left = '15%'; 
                
                setTimeout(() => {
                    victoryScreen.style.display = 'flex';
                    setTimeout(() => {
                        victoryScreen.style.opacity = '1';
                        victoryScreen.querySelector('.polaroid').style.transform = 'rotate(-3deg) scale(1)';
                    }, 50);
                }, 800);
            } else {
                // ERREUR
                liko.style.opacity = 1;
                // Si on est dans le futur (> 16.67%), montrer fl√®che gauche
                if (scrollPct > 16.67) {
                    arrowL.style.display = 'flex';
                    setTimeout(() => arrowL.style.display = 'none', 3000);
                }
            }
        }

        liko.addEventListener('mousedown', dragStart);
        liko.addEventListener('touchstart', dragStart);
        window.addEventListener('mousemove', dragMove);
        window.addEventListener('touchmove', dragMove, {passive:false});
        window.addEventListener('mouseup', dragEnd);
        window.addEventListener('touchend', dragEnd);

        update();

    </script>
</body>
</html>